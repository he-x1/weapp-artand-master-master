"""
åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
"""
import sys
import os

sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from app import create_app
from app.models import db, Culture, Category
from loguru import logger


def init_sample_data():
    """åˆå§‹åŒ–ç¤ºä¾‹æ–‡åŒ–æ•°æ®"""
    app = create_app()

    with app.app_context():
        # ç¤ºä¾‹æ•°æ®åˆ—è¡¨
        sample_data = [
            {
                'name': 'è‹ç»£',
                'category_id': 1,
                'description': 'è‹ç»£æ˜¯ä¸­å›½ä¼˜ç§€çš„æ°‘æ—ä¼ ç»Ÿå·¥è‰ºä¹‹ä¸€ï¼Œæ˜¯è‹å·åœ°åŒºåˆºç»£äº§å“çš„æ€»ç§°ï¼Œä»¥é’ˆæ³•ç²¾ç»†ã€è‰²å½©é›…è‡´è‘—ç§°ï¼Œè¢«èª‰ä¸º"ä¸œæ–¹è‰ºæœ¯æ˜ç "ã€‚è‹ç»£å…·æœ‰å›¾æ¡ˆç§€ä¸½ã€æ„æ€å·§å¦™ã€ç»£å·¥ç»†è‡´ã€é’ˆæ³•æ´»æ³¼ã€è‰²å½©æ¸…é›…çš„ç‹¬ç‰¹é£æ ¼ã€‚',
                'summary': 'è‹ç»£æ˜¯ä¸­å›½å››å¤§åç»£ä¹‹ä¸€ï¼Œæºè‡ªæ±Ÿè‹è‹å·ï¼Œä»¥é’ˆæ³•ç²¾ç»†ã€è‰²å½©é›…è‡´è‘—ç§°ï¼Œå±å›½å®¶çº§éç‰©è´¨æ–‡åŒ–é—äº§ã€‚',
                'origin': 'æ±Ÿè‹è‹å·',
                'heritage_level': 'å›½å®¶çº§',
                'cover_image': '/images/Shadow_puppetry.png'
            },
            {
                'name': 'æ™¯å¾·é•‡ç“·å™¨',
                'category_id': 1,
                'description': 'æ™¯å¾·é•‡ç“·å™¨ä»¥"ç™½å¦‚ç‰ã€æ˜å¦‚é•œã€è–„å¦‚çº¸ã€å£°å¦‚ç£¬"çš„ç‹¬ç‰¹é£æ ¼é—»åä¸­å¤–ï¼Œæ˜¯ä¸­å›½ç“·å™¨è‰ºæœ¯çš„æ°å‡ºä»£è¡¨ã€‚æ™¯å¾·é•‡åˆ¶ç“·å†å²æ‚ ä¹…ï¼ŒæŠ€è‰ºç²¾æ¹›ï¼Œäº§å“è¿œé”€æµ·å†…å¤–ã€‚',
                'summary': 'æ™¯å¾·é•‡ç“·å™¨æºè‡ªæ±Ÿè¥¿æ™¯å¾·é•‡ï¼Œä»¥"ç™½å¦‚ç‰ã€æ˜å¦‚é•œã€è–„å¦‚çº¸ã€å£°å¦‚ç£¬"è‘—ç§°ï¼Œå±å›½å®¶çº§éç‰©è´¨æ–‡åŒ–é—äº§ã€‚',
                'origin': 'æ±Ÿè¥¿æ™¯å¾·é•‡',
                'heritage_level': 'å›½å®¶çº§',
                'cover_image': '/images/Cookie_cutter.png'
            },
            {
                'name': 'äº¬å‰§',
                'category_id': 2,
                'description': 'äº¬å‰§æ˜¯ä¸­å›½äº”å¤§æˆæ›²å‰§ç§ä¹‹ä¸€ï¼Œè¢«è§†ä¸ºä¸­å›½å›½ç²¹ã€‚äº¬å‰§ä»¥å…¶ç‹¬ç‰¹çš„å”±è…”ã€ç²¾æ¹›çš„è¡¨æ¼”å’Œåä¸½çš„æœé¥°è‘—ç§°ï¼Œèåˆäº†å”±ã€å¿µã€åšã€æ‰“ç­‰å¤šç§è¡¨æ¼”å½¢å¼ã€‚',
                'summary': 'äº¬å‰§æ˜¯ä¸­å›½å›½ç²¹ï¼Œæºè‡ªåŒ—äº¬ï¼Œèåˆå”±å¿µåšæ‰“ç­‰è¡¨æ¼”å½¢å¼ï¼Œå±ä¸–ç•Œçº§éç‰©è´¨æ–‡åŒ–é—äº§ã€‚',
                'origin': 'åŒ—äº¬',
                'heritage_level': 'ä¸–ç•Œçº§',
                'cover_image': '/images/New_Year_pictures.png'
            },
            {
                'name': 'æ˜†æ›²',
                'category_id': 2,
                'description': 'æ˜†æ›²æ˜¯ä¸­å›½å¤è€çš„æˆæ›²å£°è…”ã€å‰§ç§ï¼Œè¢«èª‰ä¸º"ç™¾æˆä¹‹ç¥–"ã€‚æ˜†æ›²å”±è…”åä¸½å©‰è½¬ã€å¿µç™½å„’é›…ã€è¡¨æ¼”ç»†è…»ï¼Œæ˜¯ä¸­å›½ä¼ ç»Ÿæˆæ›²è‰ºæœ¯çš„ç‘°å®ã€‚',
                'summary': 'æ˜†æ›²æ˜¯"ç™¾æˆä¹‹ç¥–"ï¼Œæºè‡ªæ±Ÿè‹æ˜†å±±ï¼Œå”±è…”åä¸½å©‰è½¬ï¼Œå±ä¸–ç•Œçº§éç‰©è´¨æ–‡åŒ–é—äº§ã€‚',
                'origin': 'æ±Ÿè‹æ˜†å±±',
                'heritage_level': 'ä¸–ç•Œçº§',
                'cover_image': '/images/candle.png'
            },
            {
                'name': 'ç«¯åˆèŠ‚',
                'category_id': 6,
                'description': 'ç«¯åˆèŠ‚æ˜¯é›†æ‹œç¥ç¥­ç¥–ã€ç¥ˆç¦è¾Ÿé‚ªã€æ¬¢åº†å¨±ä¹å’Œé¥®é£Ÿä¸ºä¸€ä½“çš„æ°‘ä¿—å¤§èŠ‚ï¼Œæœ‰èµ›é¾™èˆŸã€åƒç²½å­ã€æŒ‚è‰¾è‰ç­‰ä¼ ç»Ÿä¹ ä¿—ï¼Œçºªå¿µçˆ±å›½è¯—äººå±ˆåŸã€‚',
                'summary': 'ç«¯åˆèŠ‚æ˜¯ä¸­å›½ä¼ ç»ŸèŠ‚æ—¥ï¼Œæœ‰èµ›é¾™èˆŸã€åƒç²½å­ç­‰ä¹ ä¿—ï¼Œçºªå¿µçˆ±å›½è¯—äººå±ˆåŸï¼Œå±ä¸–ç•Œçº§éç‰©è´¨æ–‡åŒ–é—äº§ã€‚',
                'origin': 'ä¸­å›½',
                'heritage_level': 'ä¸–ç•Œçº§',
                'cover_image': '/images/stamp.png'
            },
            {
                'name': 'æ˜¥èŠ‚',
                'category_id': 6,
                'description': 'æ˜¥èŠ‚æ˜¯ä¸­åæ°‘æ—æœ€éš†é‡çš„ä¼ ç»Ÿä½³èŠ‚ï¼Œæ˜¯é›†ç¥ˆç¦æ”˜ç¾ã€æ¬¢åº†å¨±ä¹å’Œé¥®é£Ÿä¸ºä¸€ä½“çš„æ°‘ä¿—å¤§èŠ‚ï¼Œæœ‰è´´æ˜¥è”ã€æ”¾é­ç‚®ã€æ‹œå¹´ç­‰ä¼ ç»Ÿä¹ ä¿—ã€‚',
                'summary': 'æ˜¥èŠ‚æ˜¯ä¸­åæ°‘æ—æœ€é‡è¦çš„ä¼ ç»ŸèŠ‚æ—¥ï¼Œæœ‰è´´æ˜¥è”ã€æ”¾é­ç‚®ã€æ‹œå¹´ç­‰ä¹ ä¿—ï¼Œå±å›½å®¶çº§éç‰©è´¨æ–‡åŒ–é—äº§ã€‚',
                'origin': 'ä¸­å›½',
                'heritage_level': 'å›½å®¶çº§',
                'cover_image': '/images/plate.png'
            },
            {
                'name': 'å«¦å¨¥å¥”æœˆ',
                'category_id': 4,
                'description': 'å«¦å¨¥å¥”æœˆæ˜¯ä¸­å›½ä¸Šå¤æ—¶ä»£ç¥è¯ä¼ è¯´æ•…äº‹ï¼Œè®²è¿°äº†å«¦å¨¥å·é£Ÿä¸æ­»ä¹‹è¯åé£å‡æœˆå®«çš„æ•…äº‹ï¼Œå¯„æ‰˜äº†äººä»¬å¯¹ç¾å¥½ç”Ÿæ´»çš„å‘å¾€ã€‚',
                'summary': 'å«¦å¨¥å¥”æœˆæ˜¯ä¸­å›½å¤ä»£ç¥è¯ä¼ è¯´ï¼Œè®²è¿°å«¦å¨¥é£å‡æœˆå®«çš„æ•…äº‹ï¼Œå¯„æ‰˜äººä»¬å¯¹ç¾å¥½ç”Ÿæ´»çš„å‘å¾€ã€‚',
                'origin': 'ä¸­å›½',
                'heritage_level': 'æ°‘é—´ä¼ è¯´',
                'cover_image': '/images/cup.png'
            },
            {
                'name': 'å°‘æ—åŠŸå¤«',
                'category_id': 2,
                'description': 'å°‘æ—åŠŸå¤«æ˜¯ä¸­å›½æ­¦æœ¯ä¸­ä½“ç³»æœ€åºå¤§çš„é—¨æ´¾ï¼Œæ˜¯ä¸­åæ­¦æœ¯çš„è±¡å¾ã€‚å°‘æ—åŠŸå¤«ä»¥ç¦…æ­¦åˆä¸€ã€å†…å¤–å…¼ä¿®è‘—ç§°ï¼ŒåŒ…å«ä¸°å¯Œçš„å¥—è·¯å’ŒæŠ€æ³•ã€‚',
                'summary': 'å°‘æ—åŠŸå¤«æºè‡ªæ²³å—ç™»å°ï¼Œç¦…æ­¦åˆä¸€ã€å†…å¤–å…¼ä¿®ï¼Œæ˜¯ä¸­åæ­¦æœ¯çš„è±¡å¾ï¼Œå±ä¸–ç•Œçº§éç‰©è´¨æ–‡åŒ–é—äº§ã€‚',
                'origin': 'æ²³å—ç™»å°',
                'heritage_level': 'ä¸–ç•Œçº§',
                'cover_image': '/images/Shadow_puppetry.png'
            },
            {
                'name': 'è‹—æ—é“¶é¥°',
                'category_id': 1,
                'description': 'è‹—æ—é“¶é¥°æ˜¯è‹—æ—é‡è¦çš„æ–‡åŒ–æ ‡å¿—ï¼Œç²¾ç¾çš„å·¥è‰ºåœ¨ä¸­å›½æ°‘æ—é¦–é¥°ä¸­å æœ‰é‡è¦åœ°ä½ã€‚è‹—æ—é“¶é¥°é€ å‹ç¾è§‚ã€å·¥è‰ºç²¾æ¹›ï¼Œä½“ç°äº†è‹—æ—äººæ°‘çš„æ™ºæ…§ã€‚',
                'summary': 'è‹—æ—é“¶é¥°æºè‡ªè´µå·ã€æ¹–å—ï¼Œå·¥è‰ºç²¾æ¹›ã€é€ å‹ç¾è§‚ï¼Œæ˜¯è‹—æ—æ–‡åŒ–æ ‡å¿—ï¼Œå±å›½å®¶çº§éç‰©è´¨æ–‡åŒ–é—äº§ã€‚',
                'origin': 'è´µå·ã€æ¹–å—',
                'heritage_level': 'å›½å®¶çº§',
                'cover_image': '/images/Cookie_cutter.png'
            },
            {
                'name': 'æ³¥äººå¼ ',
                'category_id': 1,
                'description': 'æ³¥äººå¼ å½©å¡‘ä¸ºå¤©æ´¥å¸‚çš„ä¸€ç§æ°‘é—´æ–‡åŒ–ï¼Œæ˜¯è‘—åçš„æ±‰æ—ä¼ ç»Ÿæ‰‹å·¥è‰ºå“ä¹‹ä¸€ã€‚æ³¥äººå¼ å½©å¡‘é€ å‹ç”ŸåŠ¨ã€è‰²å½©ä¸°å¯Œï¼Œå…·æœ‰å¾ˆé«˜çš„è‰ºæœ¯ä»·å€¼ã€‚',
                'summary': 'æ³¥äººå¼ å½©å¡‘æºè‡ªå¤©æ´¥ï¼Œé€ å‹ç”ŸåŠ¨ã€è‰²å½©ä¸°å¯Œï¼Œæ˜¯è‘—åçš„ä¼ ç»Ÿæ‰‹å·¥è‰ºï¼Œå±å›½å®¶çº§éç‰©è´¨æ–‡åŒ–é—äº§ã€‚',
                'origin': 'å¤©æ´¥',
                'heritage_level': 'å›½å®¶çº§',
                'cover_image': '/images/New_Year_pictures.png'
            }
        ]

        try:
            imported_count = 0

            for item in sample_data:
                # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                existing = Culture.query.filter_by(name=item['name']).first()
                if existing:
                    # æ›´æ–°ç°æœ‰æ•°æ®
                    existing.description = item.get('description', '')
                    existing.summary = item.get('summary', '')
                    existing.origin = item.get('origin', 'ä¸­å›½')
                    existing.heritage_level = item.get('heritage_level')
                    existing.cover_image = item.get('cover_image', '/images/bg.png')
                    logger.info(f'æ›´æ–°æ•°æ®: {item["name"]}')
                else:
                    # åˆ›å»ºè®°å½•
                    culture = Culture(
                        name=item['name'],
                        category_id=item['category_id'],
                        description=item.get('description', ''),
                        summary=item.get('summary', ''),
                        origin=item.get('origin', 'ä¸­å›½'),
                        heritage_level=item.get('heritage_level'),
                        cover_image=item.get('cover_image', '/images/bg.png'),
                        source='ç¤ºä¾‹æ•°æ®',
                        status=1,
                        is_recommend=True,
                        score=50.0
                    )
                    db.session.add(culture)
                    logger.info(f'æ·»åŠ : {item["name"]}')
                imported_count += 1

            db.session.commit()
            logger.info(f'âœ… æˆåŠŸå¤„ç† {imported_count} æ¡ç¤ºä¾‹æ•°æ®')

        except Exception as e:
            db.session.rollback()
            logger.error(f'âŒ å¯¼å…¥å¤±è´¥: {e}')


if __name__ == '__main__':
    logger.info('ğŸš€ å¼€å§‹åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®...')
    init_sample_data()
